databaseChangeLog:
  - changeSet:
      id: 002-create-entities-table
      author: panama-papers-poc
      comment: Create ENTITIES table for offshore companies/trusts
      changes:
        - sql:
            sql: |
              CREATE TABLE panama_papers.entities (
                  node_id           VARCHAR2(50) PRIMARY KEY,
                  name              VARCHAR2(500),
                  jurisdiction      VARCHAR2(200),
                  jurisdiction_desc VARCHAR2(500),
                  country_codes     VARCHAR2(200),
                  countries         VARCHAR2(500),
                  incorporation_date DATE,
                  inactivation_date DATE,
                  struck_off_date   DATE,
                  status            VARCHAR2(100),
                  service_provider  VARCHAR2(200),
                  source_id         VARCHAR2(100),
                  address           VARCHAR2(1000),
                  internal_id       VARCHAR2(100),
                  name_embedding    VECTOR(384, FLOAT32),
                  load_timestamp    TIMESTAMP DEFAULT SYSTIMESTAMP
              )

  - changeSet:
      id: 002-create-officers-table
      author: panama-papers-poc
      comment: Create OFFICERS table for directors/shareholders/beneficiaries
      changes:
        - sql:
            sql: |
              CREATE TABLE panama_papers.officers (
                  node_id           VARCHAR2(50) PRIMARY KEY,
                  name              VARCHAR2(500),
                  country_codes     VARCHAR2(200),
                  countries         VARCHAR2(500),
                  source_id         VARCHAR2(100),
                  valid_until       VARCHAR2(500),
                  name_embedding    VECTOR(384, FLOAT32),
                  load_timestamp    TIMESTAMP DEFAULT SYSTIMESTAMP
              )

  - changeSet:
      id: 002-create-intermediaries-table
      author: panama-papers-poc
      comment: Create INTERMEDIARIES table for law firms/banks/agents
      changes:
        - sql:
            sql: |
              CREATE TABLE panama_papers.intermediaries (
                  node_id           VARCHAR2(50) PRIMARY KEY,
                  name              VARCHAR2(500),
                  country_codes     VARCHAR2(200),
                  countries         VARCHAR2(500),
                  source_id         VARCHAR2(100),
                  status            VARCHAR2(100),
                  internal_id       VARCHAR2(100),
                  address           VARCHAR2(1000),
                  name_embedding    VECTOR(384, FLOAT32),
                  load_timestamp    TIMESTAMP DEFAULT SYSTIMESTAMP
              )

  - changeSet:
      id: 002-create-addresses-table
      author: panama-papers-poc
      comment: Create ADDRESSES table with spatial geometry
      changes:
        - sql:
            sql: |
              CREATE TABLE panama_papers.addresses (
                  node_id           VARCHAR2(50) PRIMARY KEY,
                  address           VARCHAR2(2000),
                  country_codes     VARCHAR2(200),
                  countries         VARCHAR2(500),
                  source_id         VARCHAR2(100),
                  location          SDO_GEOMETRY,
                  load_timestamp    TIMESTAMP DEFAULT SYSTIMESTAMP
              )

  - changeSet:
      id: 002-register-spatial-metadata
      author: panama-papers-poc
      comment: Register spatial column metadata
      changes:
        - sql:
            sql: |
              INSERT INTO user_sdo_geom_metadata (table_name, column_name, diminfo, srid)
              SELECT 'ADDRESSES', 'LOCATION',
                  SDO_DIM_ARRAY(
                      SDO_DIM_ELEMENT('Longitude', -180, 180, 0.005),
                      SDO_DIM_ELEMENT('Latitude', -90, 90, 0.005)
                  ),
                  4326
              FROM dual
              WHERE NOT EXISTS (
                  SELECT 1 FROM user_sdo_geom_metadata
                  WHERE table_name = 'ADDRESSES' AND column_name = 'LOCATION'
              )

  - changeSet:
      id: 002-create-relationships-table
      author: panama-papers-poc
      comment: Create RELATIONSHIPS table for graph edges
      changes:
        - sql:
            sql: |
              CREATE TABLE panama_papers.relationships (
                  rel_id            NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
                  node_id_start     VARCHAR2(50) NOT NULL,
                  node_id_end       VARCHAR2(50) NOT NULL,
                  rel_type          VARCHAR2(100) NOT NULL,
                  source_id         VARCHAR2(100),
                  start_date        DATE,
                  end_date          DATE,
                  load_timestamp    TIMESTAMP DEFAULT SYSTIMESTAMP
              )
